import{a as h,b as K,c as W,e as X}from"./chunk-C4SECMBV.js";import{a as B,b as L,c as G,d as Q,g as z,h as R,i as q,j as H,l as U}from"./chunk-HJYBRKGG.js";import{C as J}from"./chunk-LSQM6BLU.js";import{h as N,i as V,j as D,l as $,m as A}from"./chunk-SZWDHQBB.js";import{Bb as u,Cb as I,Db as F,Jb as E,Lb as T,Mb as k,Na as s,Oa as p,aa as b,bb as f,db as l,ga as v,hb as o,ib as c,jb as d,ka as C,kb as y,lb as M,nb as S,pb as j,qb as g,ua as _,va as x,wb as w,xb as O,yb as P}from"./chunk-ISEL6VX3.js";var Y=(()=>{let n=class n{constructor(){this.firestore=v(W)}guardarChats(t){let e=h(this.firestore,"chats");return K(e,t)}obtenerChats(){let t=h(this.firestore,"chats");return X(t)}};n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=b({token:n,factory:n.\u0275fac,providedIn:"root"});let i=n;return i})();var te=["contenedorMensajes"];function ne(i,n){i&1&&(o(0,"div",15),d(1,"div",16),c())}function ie(i,n){if(i&1&&(o(0,"p",17),u(1),o(2,"span"),u(3),c()()),i&2){let r=n.$implicit,t=g().ngIf;l("ngClass",t.email===r.mail?"enviado":"recibido"),s(),F(" ",r.texto," "),s(2),I(r.date)}}function oe(i,n){if(i&1){let r=S();y(0),o(1,"div",3),u(2,"CHAT"),c(),o(3,"div",4,0),f(5,ne,2,0,"div",5),o(6,"div",6),f(7,ie,4,3,"p",7),c()(),d(8,"div",8),o(9,"div",9)(10,"form",10),j("ngSubmit",function(){_(r);let e=g();return x(e.enviarMensaje())}),o(11,"div",11),d(12,"input",12),o(13,"button",13),d(14,"img",14),c()()()(),M()}if(i&2){let r=g();s(5),l("ngIf",r.isLoading),s(2),l("ngForOf",r.mensajes),s(3),l("formGroup",r.form)}}var ge=(()=>{let n=class n{constructor(t,e,a){this.chatService=t,this.userAuthService=e,this.formB=a,this.mensajes=[],this.isLoading=!0,this.form=this.formB.nonNullable.group({mensaje:["",L.required]}),this.auxObservable$=this.userAuthService.getUser(),this.auxObservable$.subscribe(m=>{this.user$=m})}ngOnInit(){this.chatService.obtenerChats().subscribe(t=>{t.sort((e,a)=>e.date.localeCompare(a.date)),this.mensajes=t,this.isLoading=!1})}ngAfterViewChecked(){this.mensajes.length>0&&this.scrollToBottom()}enviarMensaje(){let t=this.form.getRawValue(),e=new Date,a={texto:t.mensaje,mail:this.user$?.email||"",date:`${e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})} - ${e.toLocaleTimeString()}`};this.chatService.guardarChats(a),this.form.setValue({mensaje:""}),this.scrollToBottom()}scrollToBottom(){try{this.contenedorMensajes.nativeElement.scrollTop=this.contenedorMensajes.nativeElement.scrollHeight}catch(t){console.error("Error scrolling to bottom",t)}}};n.\u0275fac=function(e){return new(e||n)(p(Y),p(J),p(H))},n.\u0275cmp=C({type:n,selectors:[["app-chat"]],viewQuery:function(e,a){if(e&1&&w(te,5),e&2){let m;O(m=P())&&(a.contenedorMensajes=m.first)}},standalone:!0,features:[E],decls:3,vars:3,consts:[["contenedorMensajes",""],["id","divTotal"],[4,"ngIf"],[1,"header"],[1,"card-body"],["class","spinner-container",4,"ngIf"],["data-bs-spy","scroll",1,"contenedorMensajes",2,"padding-bottom","5px"],[3,"ngClass",4,"ngFor","ngForOf"],[1,"espaciador"],[1,"card-footer","text-body-secondary","contenedorFooter"],[3,"ngSubmit","formGroup"],[1,"input-group","mb-3"],["type","text","placeholder","Ingrese su mensaje","formControlName","mensaje",1,"form-control"],["id","basic-addon2",1,"input-group-text"],["src","../../../assets/iconoenviar.png",1,"botonEnviar"],[1,"spinner-container"],["role","status",1,"spinner-border"],[3,"ngClass"]],template:function(e,a){e&1&&(o(0,"div",1),f(1,oe,15,3,"ng-container",2),T(2,"async"),c()),e&2&&(s(),l("ngIf",k(2,1,a.auxObservable$)))},dependencies:[U,z,B,G,Q,R,q,A,N,V,D,$],styles:["#divTotal[_ngcontent-%COMP%]{position:fixed;top:55px;left:0;height:100%;width:100%;background-repeat:no-repeat;height:calc(100% - 55px);background-size:cover;z-index:8;display:flex;flex-direction:column}.header[_ngcontent-%COMP%], .header2[_ngcontent-%COMP%]{background-color:#431d88;color:#fff;font-weight:700;padding:1rem;text-align:center}.card-body[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1rem;background-color:#fff}.card-body[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.botonEnviar[_ngcontent-%COMP%]{width:30px;height:30px}.enviado[_ngcontent-%COMP%], .recibido[_ngcontent-%COMP%]{padding:.5rem;display:block;color:#fff;min-width:50.01%;border-radius:16px;text-align:left;max-width:80%;margin-bottom:.5rem;word-wrap:break-word}.enviado[_ngcontent-%COMP%]{float:right;background:linear-gradient(45deg,#650ebd,#d23aca)}.recibido[_ngcontent-%COMP%]{float:left;background-color:gray}p[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:10px;color:#ffffffb2}.contenedorFooter[_ngcontent-%COMP%]{padding:1rem;background-color:#431d88}.input-group[_ngcontent-%COMP%]{display:flex;width:100%}.spinner-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%}.spinner-border[_ngcontent-%COMP%]{width:3rem;height:3rem;border-width:.3rem}.espaciador[_ngcontent-%COMP%]{height:.5rem}"]});let i=n;return i})();export{ge as ChatComponent};
